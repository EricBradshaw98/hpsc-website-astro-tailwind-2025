---
import type { GetStaticPaths } from 'astro';
import Layout from '../../layouts/Layout.astro';
import { newsArticles, type NewsArticle } from '../../data/news';

export const getStaticPaths = (() => {
	return newsArticles.map(article => ({
		params: { slug: article.slug },
		props: { article },
	}));
}) satisfies GetStaticPaths;

interface Props {
	article: NewsArticle;
}

const { article } = Astro.props;

// Format date helper
function formatDate(date: Date): string {
	return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
}

// Get related articles (same category, excluding current)
const relatedArticles = newsArticles
	.filter(a => a.category === article.category && a.slug !== article.slug)
	.sort((a, b) => b.date.getTime() - a.date.getTime())
	.slice(0, 3);
---

<Layout
	title={`${article.title} | HPSC News`}
	description={article.excerpt}
	keywords={article.tags.join(', ')}
	breadcrumbs={[
		{ label: 'News', href: '/news' },
		{ label: article.title, href: `/news/${article.slug}` },
	]}
>

	<!-- Article Header -->
	<article class="mb-16">
		<div class="mb-8">
			<div class="flex items-center gap-3 mb-4">
				<span class="inline-block px-3 py-1 bg-primary/10 text-primary rounded-full text-sm font-semibold">
					{article.category}
				</span>
				<span class="text-gray-500">{formatDate(article.date)}</span>
			</div>

			<h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
				{article.title}
			</h1>

			<div class="flex items-center gap-4 text-gray-600">
				<span>By {article.author}</span>
				<span>•</span>
				<span>{article.tags.join(', ')}</span>
			</div>
		</div>

		<!-- Featured Image -->
		<div class="mb-8 rounded-2xl overflow-hidden">
			<img
				src={article.image}
				alt={article.title}
				class="w-full h-auto max-h-[500px] object-cover"
				loading="eager"
			/>
		</div>

		<!-- Article Content -->
		<div class="prose prose-lg max-w-none">
			<div class="text-xl text-gray-700 mb-8 font-medium leading-relaxed">
				{article.excerpt}
			</div>

			<div class="article-content" set:html={article.content} />
		</div>

		<!-- Tags -->
		<div class="mt-12 pt-8 border-t border-gray-200">
			<h3 class="text-sm font-semibold text-gray-700 mb-3">Tags:</h3>
			<div class="flex flex-wrap gap-2">
				{article.tags.map(tag => (
					<span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200 transition-colors">
						{tag}
					</span>
				))}
			</div>
		</div>

		<!-- Share -->
		<div class="mt-8 pt-8 border-t border-gray-200">
			<h3 class="text-sm font-semibold text-gray-700 mb-3">Share this article:</h3>
			<div class="flex gap-4">
				<a
					href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(article.title)}&url=${encodeURIComponent(Astro.url.href)}`}
					target="_blank"
					rel="noopener noreferrer"
					class="px-4 py-2 bg-blue-400 text-white rounded-lg hover:bg-blue-500 transition-colors"
					aria-label="Share on Twitter"
				>
					Twitter
				</a>
				<a
					href={`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(Astro.url.href)}`}
					target="_blank"
					rel="noopener noreferrer"
					class="px-4 py-2 bg-blue-700 text-white rounded-lg hover:bg-blue-800 transition-colors"
					aria-label="Share on LinkedIn"
				>
					LinkedIn
				</a>
				<a
					href={`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(Astro.url.href)}`}
					target="_blank"
					rel="noopener noreferrer"
					class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
					aria-label="Share on Facebook"
				>
					Facebook
				</a>
			</div>
		</div>
	</article>

	<!-- Related Articles -->
	{relatedArticles.length > 0 && (
		<section class="mb-16">
			<h2 class="text-3xl font-bold text-gray-900 mb-8">Related Articles</h2>

			<div class="grid grid-cols-1 md:grid-cols-3 gap-8">
				{relatedArticles.map((related) => (
					<article class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-shadow">
						<a href={`/news/${related.slug}`}>
							<div class="h-48 overflow-hidden">
								<img
									src={related.image}
									alt={related.title}
									class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
									loading="lazy"
								/>
							</div>
						</a>
						<div class="p-6">
							<div class="flex items-center gap-2 mb-2">
								<span class="text-xs font-semibold text-primary bg-primary/10 px-2 py-1 rounded">
									{related.category}
								</span>
								<span class="text-sm text-gray-500">{formatDate(related.date)}</span>
							</div>
							<a href={`/news/${related.slug}`}>
								<h3 class="text-xl font-semibold mb-2 hover:text-primary transition-colors">
									{related.title}
								</h3>
							</a>
							<p class="text-gray-600 mb-4 line-clamp-3">
								{related.excerpt}
							</p>
							<a
								href={`/news/${related.slug}`}
								class="text-primary font-medium hover:underline"
								aria-label={`Read more about ${related.title}`}
							>
								Read More →
							</a>
						</div>
					</article>
				))}
			</div>
		</section>
	)}

	<!-- Back to News -->
	<div class="text-center">
		<a
			href="/news"
			class="inline-flex items-center gap-2 px-6 py-3 bg-primary text-white rounded-lg font-semibold hover:bg-primary-dark transition-colors"
		>
			← Back to All News
		</a>
	</div>
</Layout>

<style>
	.article-content :global(h2) {
		font-size: 1.5rem;
		font-weight: 700;
		color: #111827;
		margin-top: 2rem;
		margin-bottom: 1rem;
	}

	.article-content :global(h3) {
		font-size: 1.25rem;
		font-weight: 700;
		color: #111827;
		margin-top: 1.5rem;
		margin-bottom: 0.75rem;
	}

	.article-content :global(p) {
		color: #374151;
		line-height: 1.625;
		margin-bottom: 1rem;
	}

	.article-content :global(ul),
	.article-content :global(ol) {
		margin-bottom: 1rem;
		padding-left: 1.5rem;
	}

	.article-content :global(ul li) {
		list-style-type: disc;
		color: #374151;
		margin-bottom: 0.5rem;
	}

	.article-content :global(ol li) {
		list-style-type: decimal;
		color: #374151;
		margin-bottom: 0.5rem;
	}

	.article-content :global(a) {
		color: #00b6f0;
		text-decoration: underline;
	}

	.article-content :global(a:hover) {
		color: #0095c7;
	}

	.article-content :global(strong) {
		font-weight: 600;
		color: #111827;
	}

	.article-content :global(blockquote) {
		border-left: 4px solid #00b6f0;
		padding-left: 1rem;
		font-style: italic;
		color: #374151;
		margin: 1.5rem 0;
	}
</style>
