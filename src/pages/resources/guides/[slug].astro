---
import { Image } from 'astro:assets';
import Layout from '../../../layouts/Layout.astro';
import Breadcrumbs from '../../../components/layouts/Breadcrumbs.astro';

const { slug } = Astro.params;

export async function getStaticPaths() {
	// Will fetch from WordPress later - for now return sample slugs
	return [
		{ params: { slug: 'getting-started-with-home-energy-assessments' } },
		{ params: { slug: 'heat-pump-installation-checklist' } },
		{ params: { slug: 'understanding-rebate-programs' } },
		{ params: { slug: 'air-sealing-best-practices' } },
		{ params: { slug: 'choosing-the-right-insulation' } },
		{ params: { slug: 'blower-door-testing-guide' } },
		{ params: { slug: 'hpsc-certification-application' } },
		{ params: { slug: 'winter-energy-saving-tips' } },
		{ params: { slug: 'moisture-management-essentials' } },
	];
}

// Guide content - will be fetched from WordPress later
const guides: Record<string, any> = {
	'heat-pump-installation-checklist': {
		title: 'Heat Pump Installation: Complete Checklist',
		description: 'Everything contractors need to know for a successful heat pump installation from start to finish.',
		category: 'Contractors',
		difficulty: 'Intermediate',
		readTime: '15 min',
		author: 'Technical Team',
		date: '2025-01-05',
		image: 'https://images.unsplash.com/photo-1581092918056-0c4c3acd3789?w=1200&h=600&fit=crop',
		steps: [
			{
				title: 'Pre-Installation Site Assessment',
				content: `<p>A thorough site assessment is critical for heat pump success. This step ensures you select the right equipment and identify potential installation challenges before starting work.</p>

				<div class="my-6 rounded-xl overflow-hidden">
					<img src="https://images.unsplash.com/photo-1581092918056-0c4c3acd3789?w=800&h=450&fit=crop" alt="Heat pump outdoor unit installation site" class="w-full h-auto" />
					<p class="text-sm text-gray-500 mt-2 italic">Example of proper outdoor unit placement and clearances</p>
				</div>

				<h3>What to Evaluate</h3>
				<ul>
					<li><strong>Electrical capacity:</strong> Verify the home has adequate electrical service (usually 200A minimum for whole-home heat pumps)</li>
					<li><strong>Existing ductwork:</strong> Assess condition, sizing, and air leakage</li>
					<li><strong>Outdoor unit location:</strong> Identify suitable placement considering noise, drainage, and clearances</li>
					<li><strong>Indoor unit placement:</strong> Determine optimal locations for air handlers or heads</li>
					<li><strong>Building envelope:</strong> Note any major air leakage or insulation issues that should be addressed first</li>
				</ul>

				<p class="bg-primary/10 p-4 rounded-lg mt-4">
					<strong>Pro Tip:</strong> Take photos and measurements during assessment. This documentation helps with equipment selection and can prevent surprises during installation.
				</p>`,
			},
			{
				title: 'Equipment Selection and Sizing',
				content: `<p>Proper sizing is crucial - oversized heat pumps cycle frequently and provide poor comfort, while undersized units won't meet heating/cooling needs.</p>

				<h3>Sizing Process</h3>
				<ol>
					<li>Perform Manual J heat load calculation</li>
					<li>Account for BC climate (use appropriate design temperatures)</li>
					<li>Consider backup heating requirements for cold-climate systems</li>
					<li>Select equipment rated for local climate conditions</li>
					<li>Verify unit qualifies for available rebate programs</li>
				</ol>

				<h3>Cold Climate Considerations</h3>
				<p>For BC installations, prioritize heat pumps with:</p>
				<ul>
					<li>Rated heating capacity at -15°C or lower</li>
					<li>Variable-speed compressors for better part-load performance</li>
					<li>Enhanced defrost cycles for wet climates</li>
				</ul>`,
			},
			{
				title: 'Obtaining Permits and Rebates',
				content: `<p>Ensure all required permits and rebate applications are in place before beginning installation.</p>

				<h3>Required Permits</h3>
				<ul>
					<li>Electrical permit (almost always required)</li>
					<li>Building/HVAC permit (check local requirements)</li>
					<li>Gas disconnect permit (if removing gas furnace)</li>
				</ul>

				<h3>Rebate Programs</h3>
				<p>BC homeowners may be eligible for:</p>
				<ul>
					<li><strong>CleanBC rebates:</strong> Up to $7,000 for cold-climate heat pumps</li>
					<li><strong>Utility incentives:</strong> BC Hydro and FortisBC programs</li>
					<li><strong>Income-qualified programs:</strong> Enhanced rebates for eligible households</li>
				</ul>

				<div class="my-6 bg-gray-50 border-2 border-gray-200 rounded-xl overflow-hidden">
					<div class="bg-gray-100 px-6 py-3 border-b border-gray-200">
						<h4 class="font-bold text-gray-900 flex items-center gap-2">
							<svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
							</svg>
							HPSC Rebate Application Guide
						</h4>
					</div>
					<iframe
						src="/documents/sample-document.pdf#view=FitH"
						class="w-full border-0"
						style="height: 600px;"
						title="HPSC Rebate Application Guide"
					></iframe>
					<div class="bg-gray-100 px-6 py-3 border-t border-gray-200 flex items-center justify-between">
						<p class="text-sm text-gray-600">HPSC Rebate Application Guide</p>
						<a
							href="/documents/sample-document.pdf"
							download
							class="inline-flex items-center gap-2 text-primary hover:text-primary-dark font-medium text-sm"
						>
							<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
							</svg>
							Download PDF
						</a>
					</div>
				</div>

				<p class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mt-4">
					<strong>Important:</strong> Pre-approval is required for most rebate programs. Submit applications before starting work.
				</p>`,
			},
			{
				title: 'Outdoor Unit Installation',
				content: `<p>Proper outdoor unit placement and installation ensures optimal performance and longevity.</p>

				<h3>Location Requirements</h3>
				<ul>
					<li>Minimum 24" clearance on service side, 12" on other sides</li>
					<li>Level pad (concrete, composite, or manufacturer-approved)</li>
					<li>Protection from roof runoff and snow loads</li>
					<li>Away from bedroom windows (noise consideration)</li>
					<li>Easy access for maintenance and snow clearing</li>
				</ul>

				<h3>Installation Steps</h3>
				<ol>
					<li>Install level pad with proper drainage</li>
					<li>Mount unit with vibration isolators</li>
					<li>Connect refrigerant lines (follow manufacturer specs for line sizing and insulation)</li>
					<li>Install condensate drain with freeze protection</li>
					<li>Run electrical supply in approved conduit</li>
					<li>Verify unit is level and secure</li>
				</ol>`,
			},
			{
				title: 'Indoor Unit and Ductwork',
				content: `<p>Indoor installation varies by system type but must ensure proper airflow and distribution.</p>

				<h3>Ducted Systems</h3>
				<ul>
					<li>Assess and seal existing ductwork (target <10% leakage)</li>
					<li>Resize supply/return as needed for heat pump airflow requirements</li>
					<li>Install air handler with proper clearances</li>
					<li>Add zoning controls if applicable</li>
					<li>Ensure adequate return air pathways</li>
				</ul>

				<h3>Ductless (Mini-Split) Systems</h3>
				<ul>
					<li>Mount indoor heads at optimal height (typically 7-8 feet)</li>
					<li>Ensure proper pitch for condensate drainage</li>
					<li>Route refrigerant lines and condensate drain through minimal penetrations</li>
					<li>Use approved line cover/conduit for exterior runs</li>
				</ul>`,
			},
			{
				title: 'Electrical Connections',
				content: `<p>All electrical work must meet BC Electrical Code and be performed by licensed electricians.</p>

				<h3>Electrical Requirements</h3>
				<ul>
					<li>Dedicated circuit(s) sized per equipment specifications</li>
					<li>Proper disconnect switches at indoor and outdoor units</li>
					<li>GFCI protection where required</li>
					<li>Low-voltage control wiring (thermostat, communication lines)</li>
				</ul>

				<h3>Common Issues to Avoid</h3>
				<ul>
					<li>Undersized wire gauge causing voltage drop</li>
					<li>Shared circuits leading to breaker trips</li>
					<li>Missing or improper disconnect switches</li>
					<li>Incorrect thermostat wiring</li>
				</ul>`,
			},
			{
				title: 'System Commissioning',
				content: `<p>Proper commissioning ensures the system operates as designed and meets performance expectations.</p>

				<div class="my-6 aspect-video rounded-xl overflow-hidden bg-gray-900">
					<iframe
						width="100%"
						height="100%"
						src="https://www.youtube.com/embed/dQw4w9WgXcQ"
						title="Heat Pump Commissioning Video"
						frameborder="0"
						allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
						allowfullscreen
						class="w-full h-full"
					></iframe>
					<p class="text-sm text-gray-500 mt-2 italic">Video tutorial: Commissioning a cold-climate heat pump</p>
				</div>

				<h3>Commissioning Checklist</h3>
				<ol>
					<li><strong>Refrigerant charge:</strong> Verify charge using manufacturer's procedures (superheat/subcooling)</li>
					<li><strong>Airflow:</strong> Measure and adjust to meet equipment specifications</li>
					<li><strong>Electrical:</strong> Check voltage, amperage, and verify all safety controls function</li>
					<li><strong>Drainage:</strong> Test condensate drains under operating conditions</li>
					<li><strong>Controls:</strong> Program thermostat, test all modes (heating, cooling, auto)</li>
					<li><strong>Defrost:</strong> Verify defrost cycle operates (or test initiation)</li>
				</ol>

				<h3>Performance Testing</h3>
				<ul>
					<li>Run system in both heating and cooling modes</li>
					<li>Measure temperature splits across indoor coil</li>
					<li>Check for unusual noises or vibrations</li>
					<li>Verify proper cycling and staging</li>
				</ul>`,
			},
			{
				title: 'Homeowner Training and Documentation',
				content: `<p>Educated homeowners are satisfied customers who will maintain their systems properly.</p>

				<div class="my-6 rounded-xl overflow-hidden">
					<img src="https://images.unsplash.com/photo-1556911220-bff31c812dba?w=800&h=450&fit=crop" alt="Homeowner learning about heat pump thermostat" class="w-full h-auto" />
					<p class="text-sm text-gray-500 mt-2 italic">Taking time to train homeowners ensures proper system operation</p>
				</div>

				<h3>What to Cover</h3>
				<ul>
					<li><strong>Thermostat operation:</strong> Programming, modes, emergency heat</li>
					<li><strong>Filter maintenance:</strong> Location, frequency, type to use</li>
					<li><strong>Normal operation:</strong> Expected sounds, frost formation, defrost cycles</li>
					<li><strong>Emergency procedures:</strong> How to turn off system, when to call for service</li>
					<li><strong>Warranty coverage:</strong> What's covered, registration requirements</li>
				</ul>

				<h3>Documentation to Provide</h3>
				<ul>
					<li>Equipment manuals and warranty information</li>
					<li>Installation photos and as-built drawings</li>
					<li>Commissioning test results</li>
					<li>Maintenance schedule and recommendations</li>
					<li>Rebate program documentation (if applicable)</li>
					<li>Service contact information</li>
				</ul>

				<div class="my-6 bg-gray-50 border-2 border-gray-200 rounded-xl p-6">
					<h4 class="font-bold text-gray-900 mb-3 flex items-center gap-2">
						<svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
						</svg>
						Sample Homeowner Documentation Package
					</h4>
					<p class="text-gray-600 mb-4">Download our template homeowner documentation package that includes maintenance schedules, warranty information, and emergency procedures.</p>
					<a href="/documents/sample-document.pdf" target="_blank" class="inline-flex items-center gap-2 bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors">
						<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
						</svg>
						Download PDF Template
					</a>
				</div>

				<p class="bg-primary/10 p-4 rounded-lg mt-4">
					<strong>Best Practice:</strong> Create a custom maintenance guide specific to the installed system. Include photos of filter locations and thermostat settings.
				</p>`,
			},
		],
		relatedGuides: [
			{
				slug: 'air-sealing-best-practices',
				title: 'Air Sealing Best Practices for Contractors',
				image: 'https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=400&h=300&fit=crop',
			},
			{
				slug: 'blower-door-testing-guide',
				title: 'Complete Guide to Blower Door Testing',
				image: 'https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=400&h=300&fit=crop',
			},
		],
	},
	'getting-started-with-home-energy-assessments': {
		title: 'Getting Started with Home Energy Assessments',
		description: 'A comprehensive guide to understanding and preparing for your home energy assessment.',
		category: 'Homeowners',
		difficulty: 'Beginner',
		readTime: '10 min',
		author: 'HPSC Team',
		date: '2025-01-06',
		image: 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=1200&h=600&fit=crop',
		steps: [
			{
				title: 'What is a Home Energy Assessment?',
				content: `<p>A home energy assessment (also called an energy audit) is a comprehensive evaluation of your home's energy use. A certified energy advisor will inspect your home to identify where you're losing energy and money.</p>

				<div class="my-6 rounded-xl overflow-hidden">
					<img src="https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=800&h=450&fit=crop" alt="Energy advisor conducting home assessment" class="w-full h-auto" />
					<p class="text-sm text-gray-500 mt-2 italic">A certified energy advisor performing a home energy assessment</p>
				</div>

				<p>During the assessment, the advisor will:</p>
				<ul>
					<li>Conduct a blower door test to measure air leakage</li>
					<li>Use thermal imaging to detect insulation gaps</li>
					<li>Inspect heating and cooling systems</li>
					<li>Review windows, doors, and building envelope</li>
					<li>Assess ventilation and indoor air quality</li>
				</ul>

				<p>The results will help you prioritize energy upgrades and qualify for rebates.</p>`,
			},
			{
				title: 'Why Get an Energy Assessment?',
				content: `<p>An energy assessment provides multiple benefits:</p>

				<h3>Financial Benefits</h3>
				<ul>
					<li><strong>Lower energy bills:</strong> Identify the upgrades that will save you the most money</li>
					<li><strong>Rebate eligibility:</strong> Required for most BC energy efficiency rebate programs</li>
					<li><strong>Increased home value:</strong> Energy-efficient homes command higher resale prices</li>
				</ul>

				<h3>Comfort Improvements</h3>
				<ul>
					<li>Eliminate drafts and cold spots</li>
					<li>Improve indoor air quality</li>
					<li>Reduce moisture and mold risks</li>
					<li>Better temperature consistency</li>
				</ul>

				<h3>Environmental Impact</h3>
				<p>Reducing your home's energy use directly lowers your carbon footprint and contributes to BC's climate action goals.</p>`,
			},
			{
				title: 'Preparing for Your Assessment',
				content: `<p>Follow these steps to prepare for your energy assessment:</p>

				<h3>Before the Appointment</h3>
				<ol>
					<li><strong>Gather utility bills:</strong> Collect 12 months of energy bills if available</li>
					<li><strong>List concerns:</strong> Note any comfort issues (drafts, cold rooms, high bills)</li>
					<li><strong>Clear access:</strong> Ensure the advisor can access attic, crawlspace, and mechanical room</li>
					<li><strong>Secure pets:</strong> Keep pets in a separate room during the assessment</li>
				</ol>

				<h3>What to Have Ready</h3>
				<ul>
					<li>Recent energy bills (gas and electricity)</li>
					<li>Information about recent renovations</li>
					<li>Details on heating/cooling equipment age</li>
					<li>Any warranties or documentation for major systems</li>
				</ul>`,
			},
			{
				title: 'During the Assessment',
				content: `<p>The assessment typically takes 2-3 hours. Here's what to expect:</p>

				<h3>The Process</h3>
				<ol>
					<li><strong>Initial walkthrough:</strong> The advisor tours your home and asks about your energy concerns</li>
					<li><strong>Blower door test:</strong> A large fan temporarily seals in a doorway to measure air leakage</li>
					<li><strong>Thermal imaging:</strong> Infrared camera reveals heat loss and insulation gaps</li>
					<li><strong>Equipment inspection:</strong> Detailed review of furnace, water heater, and other systems</li>
					<li><strong>Measurements:</strong> Room dimensions, window counts, and building details</li>
				</ol>

				<h3>Questions to Ask</h3>
				<ul>
					<li>What are my home's biggest energy losses?</li>
					<li>Which upgrades should I prioritize?</li>
					<li>What rebates am I eligible for?</li>
					<li>How much could I save annually?</li>
					<li>Can you recommend certified contractors?</li>
				</ul>`,
			},
			{
				title: 'Understanding Your Report',
				content: `<p>Within 2 weeks, you'll receive a detailed energy assessment report.</p>

				<h3>Report Contents</h3>
				<ul>
					<li><strong>Energy rating:</strong> Your home's current energy performance score</li>
					<li><strong>Upgrade recommendations:</strong> Prioritized list of improvements</li>
					<li><strong>Cost estimates:</strong> Approximate costs for each upgrade</li>
					<li><strong>Savings projections:</strong> Expected annual energy savings</li>
					<li><strong>Rebate information:</strong> Available incentives for each upgrade</li>
				</ul>

				<h3>Next Steps</h3>
				<ol>
					<li>Review recommendations with your family</li>
					<li>Determine your budget and priorities</li>
					<li>Contact HPSC-certified contractors for quotes</li>
					<li>Apply for rebates before starting work</li>
					<li>Schedule a post-retrofit assessment to verify improvements</li>
				</ol>

				<p class="bg-primary/10 p-4 rounded-lg mt-4">
					<strong>Pro Tip:</strong> Keep your assessment report - you'll need it to apply for rebates and it's valuable documentation for future home sales.
				</p>`,
			},
		],
		relatedGuides: [
			{
				slug: 'understanding-rebate-programs',
				title: 'Understanding BC Energy Rebate Programs',
				image: 'https://images.unsplash.com/photo-1554224155-6726b3ff858f?w=400&h=300&fit=crop',
			},
			{
				slug: 'choosing-the-right-insulation',
				title: 'Choosing the Right Insulation for Your Home',
				image: 'https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=400&h=300&fit=crop',
			},
		],
	},
};

const guide = guides[slug || 'getting-started-with-home-energy-assessments'] || guides['getting-started-with-home-energy-assessments'];

const formattedDate = new Date(guide.date).toLocaleDateString('en-US', {
	year: 'numeric',
	month: 'long',
	day: 'numeric',
});

const pageTitle = `${guide.title} | HPSC Guides`;
---

<Layout
	title={pageTitle}
	description={guide.description}
	keywords={`${guide.category}, guide, tutorial, HPSC`}
>
	<Breadcrumbs
		items={[
			{ label: 'Resources', href: '/resources' },
			{ label: 'Guides', href: '/resources/guides' },
			{ label: guide.title, href: `/resources/guides/${slug}` },
		]}
	/>

	<div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
		<!-- Main Content -->
		<article class="lg:col-span-3">
			<!-- Header -->
			<header class="mb-8">
				<div class="flex flex-wrap items-center gap-3 mb-4">
					<span class="px-3 py-1 bg-primary/10 text-primary text-sm font-semibold rounded-full">
						{guide.category}
					</span>
					<span class="px-3 py-1 bg-gray-100 text-gray-700 text-sm font-semibold rounded-full">
						{guide.difficulty}
					</span>
					<span class="text-sm text-gray-500">
						{guide.steps.length} steps • {guide.readTime}
					</span>
				</div>
				<h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4 leading-tight">
					{guide.title}
				</h1>
				<p class="text-xl text-gray-600 mb-4">{guide.description}</p>
				<div class="flex items-center gap-4 text-sm text-gray-500">
					<span>By {guide.author}</span>
					<span>•</span>
					<time datetime={guide.date}>{formattedDate}</time>
				</div>
			</header>

			<!-- Featured Image -->
			<div class="mb-12 rounded-2xl overflow-hidden shadow-lg">
				<Image
					src={guide.image}
					alt={guide.title}
					class="w-full h-auto"
					width={1200}
					height={600}
					loading="eager"
				/>
			</div>

			<!-- Steps -->
			<div class="space-y-12">
				{guide.steps.map((step: any, index: number) => (
					<div id={`step-${index + 1}`} class="scroll-mt-24">
						<div class="flex items-start gap-4 mb-6">
							<div class="flex-shrink-0 w-12 h-12 bg-primary text-white rounded-full flex items-center justify-center font-bold text-lg">
								{index + 1}
							</div>
							<div class="flex-1">
								<h2 class="text-2xl md:text-3xl font-bold text-gray-900">
									{step.title}
								</h2>
							</div>
						</div>
						<div class="pl-0 md:pl-16">
							<div
								class="prose prose-lg max-w-none prose-headings:font-bold prose-h3:text-xl prose-h3:mt-6 prose-h3:mb-3 prose-p:text-gray-700 prose-p:leading-relaxed prose-a:text-primary prose-a:no-underline hover:prose-a:underline prose-ul:my-4 prose-li:my-2 prose-ol:my-4 prose-strong:text-gray-900"
								set:html={step.content}
							/>
						</div>
						{index < guide.steps.length - 1 && (
							<div class="mt-8 pt-8 border-b border-gray-200"></div>
						)}
					</div>
				))}
			</div>

			<!-- Guide Complete -->
			<div class="mt-12 p-8 bg-gradient-to-r from-primary/10 to-primary/5 rounded-2xl border-2 border-primary/20">
				<div class="flex items-center gap-3 mb-4">
					<svg class="w-8 h-8 text-primary" fill="currentColor" viewBox="0 0 24 24">
						<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
					</svg>
					<h3 class="text-2xl font-bold text-gray-900">Guide Complete!</h3>
				</div>
				<p class="text-gray-700 mb-6">
					You've completed this guide. Ready to take the next step in your home performance journey?
				</p>
				<div class="flex flex-wrap gap-4">
					<a
						href="/resources/guides"
						class="px-6 py-3 bg-primary text-white rounded-lg font-semibold hover:bg-primary-dark transition-colors"
					>
						Browse More Guides
					</a>
					<a
						href="/contact"
						class="px-6 py-3 bg-white border-2 border-primary text-primary rounded-lg font-semibold hover:bg-primary/5 transition-colors"
					>
						Contact Us
					</a>
				</div>
			</div>

			<!-- Related Guides -->
			{guide.relatedGuides && guide.relatedGuides.length > 0 && (
				<div class="mt-12 pt-8 border-t border-gray-200">
					<h2 class="text-2xl font-bold text-gray-900 mb-6">Related Guides</h2>
					<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
						{guide.relatedGuides.map((related: any) => (
							<a
								href={`/resources/guides/${related.slug}`}
								class="group bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-shadow border border-gray-100 hover:border-primary"
							>
								<Image
									src={related.image}
									alt={related.title}
									class="w-full h-48 object-cover group-hover:scale-110 transition-transform duration-500"
									width={400}
									height={300}
									loading="lazy"
								/>
								<div class="p-4">
									<h3 class="font-bold text-gray-900 group-hover:text-primary transition-colors">
										{related.title}
									</h3>
								</div>
							</a>
						))}
					</div>
				</div>
			)}
		</article>

		<!-- Sidebar -->
		<aside class="lg:col-span-1">
			<div class="sticky top-24 space-y-6">
				<!-- Progress Tracker -->
				<div class="bg-white rounded-2xl shadow-md p-6">
					<h3 class="text-lg font-bold text-gray-900 mb-4">Progress</h3>
					<div class="space-y-3">
						{guide.steps.map((step: any, index: number) => (
							<a
								href={`#step-${index + 1}`}
								class="step-link block group"
								data-step={index + 1}
							>
								<div class="flex items-center gap-3">
									<div class="flex-shrink-0 w-8 h-8 border-2 border-gray-300 rounded-full flex items-center justify-center text-sm font-semibold text-gray-400 group-hover:border-primary group-hover:text-primary transition-colors">
										{index + 1}
									</div>
									<div class="flex-1 text-sm text-gray-600 group-hover:text-primary transition-colors line-clamp-2">
										{step.title}
									</div>
								</div>
							</a>
						))}
					</div>
				</div>

				<!-- Guide Info -->
				<div class="bg-gray-50 rounded-2xl p-6">
					<h3 class="text-lg font-bold text-gray-900 mb-4">Guide Information</h3>
					<dl class="space-y-3 text-sm">
						<div>
							<dt class="font-semibold text-gray-700">Category</dt>
							<dd class="text-gray-600">{guide.category}</dd>
						</div>
						<div>
							<dt class="font-semibold text-gray-700">Difficulty</dt>
							<dd class="text-gray-600">{guide.difficulty}</dd>
						</div>
						<div>
							<dt class="font-semibold text-gray-700">Reading Time</dt>
							<dd class="text-gray-600">{guide.readTime}</dd>
						</div>
						<div>
							<dt class="font-semibold text-gray-700">Total Steps</dt>
							<dd class="text-gray-600">{guide.steps.length}</dd>
						</div>
					</dl>
				</div>

				<!-- Back Button -->
				<a
					href="/resources/guides"
					class="block bg-white rounded-2xl shadow-md p-6 hover:shadow-lg transition-shadow"
				>
					<div class="flex items-center gap-3 text-primary font-semibold">
						<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M15 19l-7-7 7-7"
							></path>
						</svg>
						Back to All Guides
					</div>
				</a>
			</div>
		</aside>
	</div>
</Layout>

<script>
	// Progress tracking
	const stepLinks = document.querySelectorAll('.step-link');
	const steps = document.querySelectorAll('[id^="step-"]');

	// Intersection Observer for progress tracking
	const observerOptions = {
		root: null,
		rootMargin: '-20% 0px -70% 0px',
		threshold: 0,
	};

	const observer = new IntersectionObserver((entries) => {
		entries.forEach((entry) => {
			if (entry.isIntersecting) {
				const stepId = entry.target.id;
				const stepNumber = stepId.replace('step-', '');

				// Update active state
				stepLinks.forEach((link) => {
					const linkStep = link.getAttribute('data-step');
					const circle = link.querySelector('div > div');
					const text = link.querySelector('div > div:last-child');

					if (linkStep === stepNumber) {
						circle?.classList.remove('border-gray-300', 'text-gray-400');
						circle?.classList.add('border-primary', 'bg-primary', 'text-white');
						text?.classList.remove('text-gray-600');
						text?.classList.add('text-primary', 'font-semibold');
					} else {
						circle?.classList.remove('border-primary', 'bg-primary', 'text-white');
						circle?.classList.add('border-gray-300', 'text-gray-400');
						text?.classList.remove('text-primary', 'font-semibold');
						text?.classList.add('text-gray-600');
					}
				});
			}
		});
	}, observerOptions);

	// Observe all steps
	steps.forEach((step) => {
		observer.observe(step);
	});

	// Smooth scroll for step links
	stepLinks.forEach((link) => {
		link.addEventListener('click', (e) => {
			e.preventDefault();
			const href = link.getAttribute('href');
			if (href) {
				const target = document.querySelector(href);
				if (target) {
					target.scrollIntoView({ behavior: 'smooth', block: 'start' });
				}
			}
		});
	});
</script>
