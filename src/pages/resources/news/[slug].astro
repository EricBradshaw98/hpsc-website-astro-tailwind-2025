---
import { Image } from 'astro:assets';
import Layout from '../../../layouts/Layout.astro';

// This will be replaced with WordPress API data later
// For now, we'll use the slug from the URL to fetch mock data
const { slug } = Astro.params;

export async function getStaticPaths() {
	// When connected to WordPress, this will fetch all post slugs from the API
	// For now, return the mock article slugs
	return [
		{ params: { slug: 'hpsc-launches-new-contractor-certification-program' } },
		{ params: { slug: 'new-energy-efficiency-rebates-available' } },
		{ params: { slug: 'heat-pump-technology-advances' } },
		{ params: { slug: 'hpsc-annual-conference-2025' } },
		{ params: { slug: 'building-code-updates-impact-standards' } },
		{ params: { slug: 'net-zero-heritage-home-success-story' } },
		{ params: { slug: 'winter-preparedness-workshop-series' } },
		{ params: { slug: 'indoor-air-quality-hidden-benefit' } },
	];
}

// Mock article data - will be replaced with WordPress + Yoast SEO data
const mockArticles: Record<string, any> = {
	'hpsc-launches-new-contractor-certification-program': {
		id: 1,
		slug: 'hpsc-launches-new-contractor-certification-program',
		title: 'HPSC Launches New Contractor Certification Program',
		content: `
			<p>We are thrilled to announce the launch of our comprehensive contractor certification program, designed to elevate standards and professionalism in the home performance industry across British Columbia.</p>

			<h2>Program Overview</h2>
			<p>The new certification program represents a significant milestone in our mission to advance the residential retrofit sector. Developed in collaboration with industry experts, energy advisors, and educational institutions, this program provides contractors with the knowledge and credentials needed to excel in today's evolving market.</p>

			<h2>Key Features</h2>
			<ul>
				<li><strong>Comprehensive Training Modules:</strong> Covering building science fundamentals, air sealing techniques, insulation best practices, HVAC optimization, and moisture management</li>
				<li><strong>Hands-On Workshops:</strong> Practical training sessions with experienced instructors</li>
				<li><strong>Industry Recognition:</strong> Certification recognized by major utilities and government programs</li>
				<li><strong>Continuing Education:</strong> Annual credits to keep contractors updated on latest technologies and building codes</li>
			</ul>

			<h2>Benefits for Contractors</h2>
			<p>Certified contractors gain access to exclusive networking opportunities, priority listing in our contractor directory, and eligibility for special rebate programs. The certification also demonstrates commitment to quality and professionalism to potential customers.</p>

			<blockquote>
				<p>"This certification program will help distinguish qualified contractors and give homeowners confidence they're working with trained professionals who understand the complexities of whole-home energy retrofits."</p>
				<cite>— HPSC Executive Director</cite>
			</blockquote>

			<h2>How to Apply</h2>
			<p>Applications are now open for the first cohort starting in October 2025. Interested contractors can visit our training portal to review the curriculum, prerequisites, and registration details.</p>

			<p>For more information about the certification program, contact our training team at <a href="mailto:training@homeperformance.ca">training@homeperformance.ca</a> or call (604) 755-3469.</p>
		`,
		excerpt:
			'We are excited to announce the launch of our comprehensive certification program designed to elevate standards in the home performance industry.',
		image: 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=1200&h=800&fit=crop',
		date: '2025-09-15',
		category: 'Training',
		author: 'HPSC Team',
		authorBio:
			'The HPSC communications team is dedicated to sharing news and insights from the home performance industry.',
		tags: ['Certification', 'Training', 'Contractors', 'Professional Development'],
	},
	'new-energy-efficiency-rebates-available': {
		id: 2,
		slug: 'new-energy-efficiency-rebates-available',
		title: 'New Energy Efficiency Rebates Available for Homeowners',
		content: `
			<p>Great news for British Columbia homeowners! CleanBC and BC Hydro have significantly expanded their energy efficiency rebate programs, making home performance upgrades more affordable and accessible than ever before.</p>

			<h2>Expanded Rebate Programs</h2>
			<p>The enhanced programs now offer increased rebates for a wider range of upgrades, including heat pumps, insulation, windows, and whole-home energy assessments. Eligible homeowners can receive up to $15,000 in combined rebates for comprehensive retrofits.</p>

			<h2>What's New</h2>
			<ul>
				<li><strong>Increased Heat Pump Rebates:</strong> Up to $7,000 for qualifying cold-climate air source heat pumps</li>
				<li><strong>Insulation Top-Ups:</strong> Enhanced rebates for attic, wall, and basement insulation</li>
				<li><strong>Window Upgrades:</strong> New incentives for triple-pane and high-performance windows</li>
				<li><strong>Income-Qualified Programs:</strong> Additional support for low and moderate-income households</li>
			</ul>

			<h2>How to Access Rebates</h2>
			<p>Homeowners should start by booking a pre-retrofit energy assessment with a certified energy advisor. The assessment identifies the most cost-effective upgrades for your home and ensures eligibility for all available rebates.</p>

			<p>Working with HPSC-certified contractors can streamline the rebate application process and ensure all work meets program requirements for maximum rebate amounts.</p>

			<h2>Environmental and Financial Impact</h2>
			<p>These expanded programs are projected to help thousands of BC homeowners reduce their energy bills by 20-40% while significantly lowering greenhouse gas emissions. The average payback period for comprehensive retrofits has now decreased to 7-10 years.</p>

			<p>For detailed information about eligibility requirements and how to apply, visit <a href="https://betterhomesbc.ca" target="_blank" rel="noopener">BetterHomesBC.ca</a> or contact our team for personalized guidance.</p>
		`,
		excerpt:
			'CleanBC and BC Hydro have expanded their rebate programs, making energy-efficient upgrades more accessible than ever.',
		image: 'https://images.unsplash.com/photo-1582268611958-ebfd161ef9cf?w=1200&h=800&fit=crop',
		date: '2025-09-10',
		category: 'Rebates',
		author: 'Policy Team',
		authorBio:
			'Our policy team monitors and analyzes energy efficiency programs and government initiatives affecting the home performance sector.',
		tags: ['Rebates', 'CleanBC', 'BC Hydro', 'Energy Efficiency', 'Homeowners'],
	},
};

// Get article by slug (in real implementation, this would query WordPress API)
const article =
	mockArticles[slug || 'hpsc-launches-new-contractor-certification-program'] ||
	mockArticles['hpsc-launches-new-contractor-certification-program'];

// Related articles (would be determined by category/tags in real implementation)
// First try to get articles from the same category
let relatedArticles = Object.values(mockArticles)
	.filter((a: any) => a.id !== article.id && a.category === article.category)
	.slice(0, 3);

// If we don't have 3 related articles from the same category, fill with other articles
if (relatedArticles.length < 3) {
	const otherArticles = Object.values(mockArticles)
		.filter((a: any) => a.id !== article.id && !relatedArticles.find((r: any) => r.id === a.id))
		.slice(0, 3 - relatedArticles.length);
	relatedArticles = [...relatedArticles, ...otherArticles];
}

// Format date
const formattedDate = new Date(article.date).toLocaleDateString('en-US', {
	year: 'numeric',
	month: 'long',
	day: 'numeric',
});

// SEO meta data (will come from Yoast when connected to WordPress)
const pageTitle = `${article.title} | HPSC News`;
const pageDescription = article.excerpt;
const ogImage = article.image;
---

<Layout
	title={pageTitle}
	description={pageDescription}
	ogTitle={pageTitle}
	ogDescription={pageDescription}
	ogImage={ogImage}
	ogType="article"
	keywords={article.tags.join(', ')}
	breadcrumbs={[
		{ label: 'Resources', href: '/resources' },
		{ label: 'News & Updates', href: '/resources/news' },
		{ label: article.title, href: `/resources/news/${slug}` },
	]}
>

	<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
		<!-- Main Article Content -->
		<article class="lg:col-span-2">
			<!-- Article Header -->
			<header class="mb-8">
				<div class="flex items-center gap-3 mb-4">
					<span
						class="inline-block px-3 py-1 bg-primary/10 text-primary text-sm font-semibold rounded-full"
					>
						{article.category}
					</span>
					<time class="text-sm text-gray-500" datetime={article.date}>
						{formattedDate}
					</time>
				</div>
				<h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6 leading-tight">
					{article.title}
				</h1>
				<div class="flex items-center gap-4 text-gray-600">
					<span>By {article.author}</span>
					<span>•</span>
					<span>5 min read</span>
				</div>
			</header>

			<!-- Featured Image -->
			<div class="mb-8 rounded-2xl overflow-hidden">
				<Image
					src={article.image}
					alt={article.title}
					class="w-full h-auto"
					width={1200}
					height={600}
					loading="eager"
				/>
			</div>

			<!-- Article Content -->
			<div
				class="prose prose-lg max-w-none prose-headings:font-bold prose-h2:text-3xl prose-h2:mt-8 prose-h2:mb-4 prose-p:text-gray-700 prose-p:leading-relaxed prose-a:text-primary prose-a:no-underline hover:prose-a:underline prose-ul:my-6 prose-li:my-2 prose-blockquote:border-l-4 prose-blockquote:border-primary prose-blockquote:pl-6 prose-blockquote:italic prose-blockquote:text-gray-700"
			>
				<Fragment set:html={article.content} />
			</div>

			<!-- Article Tags -->
			<div class="mt-12 pt-8 border-t border-gray-200">
				<div class="flex flex-wrap items-center gap-2">
					<span class="text-gray-700 font-semibold">Tags:</span>
					{
						article.tags.map((tag: string) => (
							<a
								href={`/resources/news?tag=${tag.toLowerCase()}`}
								class="px-3 py-1 bg-gray-100 text-gray-700 text-sm rounded-full hover:bg-primary hover:text-white transition-colors"
							>
								{tag}
							</a>
						))
					}
				</div>
			</div>

			<!-- Author Bio -->
			<div class="mt-8 p-6 bg-gray-50 rounded-2xl">
				<div class="flex items-start gap-4">
					{
						article.author === 'HPSC Team' ? (
							<Image
								src="https://ui-avatars.com/api/?name=HPSC+Team&background=00b6f0&color=fff&size=64&bold=true"
								alt="HPSC Team"
								class="w-16 h-16 rounded-full flex-shrink-0"
								width={64}
								height={64}
								loading="lazy"
							/>
						) : (
							<div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center flex-shrink-0">
								<svg class="w-8 h-8 text-primary" fill="currentColor" viewBox="0 0 24 24">
									<path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
								</svg>
							</div>
						)
					}
					<div>
						<h3 class="text-lg font-bold text-gray-900 mb-1">{article.author}</h3>
						<p class="text-gray-600 text-sm">{article.authorBio}</p>
					</div>
				</div>
			</div>

			<!-- Social Sharing -->
			<div class="mt-8 pt-8 border-t border-gray-200">
				<h3 class="text-lg font-bold text-gray-900 mb-4">Share this article</h3>
				<div class="flex flex-wrap gap-3">
					<a
						href={`https://www.facebook.com/sharer/sharer.php?u=${Astro.url.href}`}
						target="_blank"
						rel="noopener noreferrer"
						class="flex items-center gap-2 px-4 py-2 bg-[#1877f2] text-white rounded-lg hover:bg-[#1565c0] transition-colors"
					>
						<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
							<path
								d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"
							></path>
						</svg>
						Facebook
					</a>
					<a
						href={`https://twitter.com/intent/tweet?url=${Astro.url.href}&text=${encodeURIComponent(article.title)}`}
						target="_blank"
						rel="noopener noreferrer"
						class="flex items-center gap-2 px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800 transition-colors"
					>
						<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
							<path
								d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"
							></path>
						</svg>
						X
					</a>
					<a
						href={`https://www.instagram.com/`}
						target="_blank"
						rel="noopener noreferrer"
						class="flex items-center gap-2 px-4 py-2 bg-gradient-to-br from-purple-600 via-pink-600 to-orange-500 text-white rounded-lg hover:opacity-90 transition-opacity"
					>
						<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
							<path
								d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"
							></path>
						</svg>
						Instagram
					</a>
					<a
						href={`https://www.linkedin.com/shareArticle?mini=true&url=${Astro.url.href}&title=${encodeURIComponent(article.title)}`}
						target="_blank"
						rel="noopener noreferrer"
						class="flex items-center gap-2 px-4 py-2 bg-[#0077b5] text-white rounded-lg hover:bg-[#006396] transition-colors"
					>
						<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
							<path
								d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"
							></path>
						</svg>
						LinkedIn
					</a>
					<button
						id="copy-link-btn"
						class="flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"
					>
						<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
							></path>
						</svg>
						Copy Link
					</button>
				</div>
			</div>

			<!-- Related Articles -->
			{
				relatedArticles.length > 0 && (
					<div class="mt-12 pt-8 border-t border-gray-200">
						<h2 class="text-3xl font-bold text-gray-900 mb-6">Related Articles</h2>
						<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
							{relatedArticles.map((related: any) => (
								<a
									href={`/resources/news/${related.slug}`}
									class="group bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-shadow"
								>
									<Image
										src={related.image}
										alt={related.title}
										class="w-full h-48 object-cover"
										width={400}
										height={192}
										loading="lazy"
									/>
									<div class="p-4">
										<h3 class="font-bold text-gray-900 group-hover:text-primary transition-colors mb-2">
											{related.title}
										</h3>
										<time class="text-sm text-gray-500">
											{new Date(related.date).toLocaleDateString('en-US', {
												month: 'short',
												day: 'numeric',
												year: 'numeric',
											})}
										</time>
									</div>
								</a>
							))}
						</div>
					</div>
				)
			}
		</article>

		<!-- Sidebar -->
		<aside class="lg:col-span-1">
			<!-- Newsletter Signup -->
			<div class="bg-linear-to-br from-primary to-primary-dark rounded-2xl p-6 mb-8 sticky top-24">
				<h3 class="text-2xl font-bold mb-3 text-white">Stay Updated</h3>
				<p class="mb-4 text-white">Get the latest news and insights delivered to your inbox.</p>
				<form class="space-y-3">
					<input
						type="email"
						placeholder="Your email address"
						class="w-full px-4 py-2 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-white"
						required
					/>
					<button
						type="submit"
						class="w-full bg-white text-primary font-semibold px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors"
					>
						Subscribe
					</button>
				</form>
			</div>

			<!-- Back to News -->
			<a
				href="/resources/news"
				class="block bg-white rounded-2xl shadow-md p-6 hover:shadow-lg transition-shadow"
			>
				<div class="flex items-center gap-3 text-primary font-semibold">
					<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path
							stroke-linecap="round"
							stroke-linejoin="round"
							stroke-width="2"
							d="M15 19l-7-7 7-7"></path>
					</svg>
					Back to All News
				</div>
			</a>
		</aside>
	</div>
</Layout>

<script>
	// Copy link functionality
	const copyLinkBtn = document.getElementById('copy-link-btn');
	copyLinkBtn?.addEventListener('click', async () => {
		try {
			await navigator.clipboard.writeText(window.location.href);
			const originalText = copyLinkBtn.innerHTML;
			copyLinkBtn.innerHTML = `
				<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
				</svg>
				Copied!
			`;
			setTimeout(() => {
				copyLinkBtn.innerHTML = originalText;
			}, 2000);
		} catch (err) {
			console.error('Failed to copy link:', err);
		}
	});
</script>
